{{ content() }}<div class="profile-full-name">    <span class="text-semibold">{{ user.name }}</span>'s profile</div><div class="profile-row">    {{ partial("partials/userleftprofile") }}    <div class="right-col">        <hr class="profile-content-hr no-grid-gutter-h">        <div class="profile-content">            <ul id="profile-tabs" class="nav nav-tabs">                <li>                    <a href="{{url('users')}}">Board</a>                </li>                <li>                    <a href="{{url('users/modify')}}">Modify</a>                </li>                <li class="active">                    <a href="javascript:;">Avatar</a>                </li>                <li>                    <a href="{{url('users/mailbox')}}">Mail Box</a>                </li>            </ul>            <div class="tab-content tab-content-bordered ">                <div class="tab-pane panel-body fade in active" id="profile-tabs-avatar">                    <form class="form-horizontal" id="avatarform">                        <div class="form-group">                            <label for="myavatar" class="col-sm-2 control-label">当前头像</label>                            <div id="myavatar" class="col-sm-10">                                {% if user.avatar is defined and user.avatar != "" %}                                <img src="{{ url('assets/images/avatars/'~user.avatar) }}">                                {% else %}                                <img src="{{ url('assets/images/avatars/female.jpg') }}">                                {% endif %}                            </div>                        </div>                        <div class="form-group">                            <label for="" class="col-sm-2 control-label">裁剪头像</label>                            <div id="cropavatar" class="col-sm-10">请单击下方按钮，先上传图片（jpg/png/gif不超过1MiB，gif无法保留动画帧）</div>                        </div>                        <div class="form-group">                            <label for="avatar_upload" class="col-sm-2 control-label">上传新头像</label>                            <div class="col-sm-10">                                <input id="avatar_upload" name="avatar_upload" type="file" multiple="false">                            </div>                        </div>                        <div class="form-group">                            <div class="col-sm-10 col-sm-offset-2">                                <input type="hidden" id="tmp_avatar" name="tmp_avatar" />                                <input type="hidden" id="xcoord" name="xcoord" />                                <input type="hidden" id="ycoord" name="ycoord" />                                <input type="hidden" id="cropw" name="cropw" />                                <input type="hidden" id="croph" name="croph" />                                <button type="button" id="submitavatar" class="btn btn-warning"><i class="fa fa-check"></i> 保存头像</button>                            </div>                        </div>                    </form>                </div>            </div>        </div>    </div></div><script type="text/javascript"><?php$timestamp = time();// 上传的照片最小允许72x72pix，截图后还是180x180pix$avatar_dimension = intval($this->config->uploader->avatar_dimension) * 0.4;?>init.push(function () {    $('body').addClass('page-profile');    $("#avatar_upload").uploadifive({        'buttonText' : 'Select Image File',        'fileSizeLimit' : <?php echo intval($this->config->uploader->avatar_size) / 1024; ?>,        'fileType' : 'image/*',        'multi' : false,        'formData' : {            'timestamp' : '<?php echo $timestamp; ?>',            'token' : '<?php echo md5('yzoi7x_v40' . $timestamp); ?>'        },        'uploadScript' : "{{ url('users/avatarup') }}",        'onUploadComplete' : function(file, data) {            var avatar = jQuery.parseJSON(data);            if (avatar.success) {                $("#cropavatar").html("<img id='croptarget' src='{{ url("assets/images/tmp/") }}" + avatar.data.imgname + "'>");                $("#tmp_avatar").val(avatar.data.imgname);                var thumbnail, x, y, w = avatar.data.width, h = avatar.data.height;                var $image = $("#croptarget");                //console.log(w);                //console.log(h);                var min = (w > h) ? h : w;                x = (w - min) / 2;                y = (h - min) / 2;                $image.Jcrop({                    aspectRatio: 1,                    minSize: [<?php echo $avatar_dimension . ', ' . $avatar_dimension ?>],                    setSelect: [x, y, w, h],                    onChange: updateCoords,                    onSelect: updateCoords                }, function () {                    thumbnail = this.initComponent('Thumbnailer', {                        width: <?php echo $avatar_dimension * 2.5; ?>,                        height: <?php echo $avatar_dimension * 2.5; ?>                    });                    this.ui.preview = thumbnail;                });            } else {                alert(avatar.data);            }        }    });    function updateCoords(c)    {        $("#xcoord").val(c.x);        $("#ycoord").val(c.y);        $("#cropw").val(c.w);        $("#croph").val(c.h);    }    function checkCoords()    {        if ($("#tmp_avatar").val() != "" && parseInt($('#cropw').val()) >= 50) return true;        return false;    }    $("#submitavatar").click(function() {        if (checkCoords()) {            jQuery.ajax({                type : 'POST',                url : "{{ url('users/avatarcrop') }}",                data : $("#avatarform").serialize(),                dataType : "json",                success : function(json) {                    //console.log(json)                    if (json.success)                    {                        $("#tmp_avatar").val("");                        $("#cropavatar").html("N/A");                        $("#myavatar").html("<img src='{{ url("assets/images/avatars/") }}" + json.data + "'>");                        alert("图像保存成功！");                        window.location.reload();                    } else {                        alert(json.data);                    }                }            });        } else {            alert('上传新头像，切割后再点击保存！');        }    });});</script>